Sub InsertDepartureNoToSQL()

    Dim conn As Object
    Dim connStr As String
    Dim wb As Workbook
    Dim ws As Worksheet
    Dim row As Long
    Dim departureNo As String
    Dim material As String
    Dim supplier As String
    Dim filePath As String
    Dim checkQuery As String
    Dim sqlQuery As String
    Dim rs As Object

    ' Downloads 폴더에 있는 arrival.xlsx 파일 경로 설정
    filePath = Environ("USERPROFILE") & "\Downloads\arrival.xlsx"

    ' DB 연결 문자열
    connStr = "Driver={SQL Server};" & _
              "Server=10.182.162.181;" & _
              "Database=tosca_com_repo;" & _
              "Uid=toscadbuser;" & _
              "Pwd=Pa55w0rd!!;" & _
              "TrustServerCertificate=yes;"

    ' SQL 연결 객체 생성
    Set conn = CreateObject("ADODB.Connection")
    conn.Open connStr

    ' arrival.xlsx 파일 열기
    Set wb = Workbooks.Open(filePath)
    Set ws = wb.Sheets(1)  ' 첫 번째 시트 사용 (시트 이름에 따라 수정 가능)

    ' 데이터가 있는 행을 확인하여 반복
    For row = 2 To ws.Cells(ws.Rows.Count, "A").End(xlUp).Row ' A열을 기준으로 마지막 행 찾기
        departureNo = ws.Cells(row, "departureNo").Value
        material = ws.Cells(row, "Material").Value
        supplier = ws.Cells(row, "Supplier").Value

        ' departureNo가 문자열이므로 작은따옴표로 감싸서 SQL에 삽입
        departureNo = "'" & departureNo & "'" ' departureNo 값이 'pgz040584546'와 같은 문자열이라면 작은따옴표로 감쌈

        ' DB에서 Material과 Supplier가 일치하는지 확인
        checkQuery = "SELECT COUNT(*) FROM YourTableName " & _
                     "WHERE material = '" & material & "' AND supplier = '" & supplier & "'"

        ' SQL 쿼리 실행하여 해당 조건의 데이터가 있는지 확인
        Set rs = conn.Execute(checkQuery)
        
        ' 조건에 맞는 데이터가 있으면 departureNo를 DB에 삽입
        If rs.Fields(0).Value > 0 Then
            ' SQL 쿼리로 departureNo 삽입
            sqlQuery = "INSERT INTO YourTableName (departureNo) " & _
                       "VALUES (" & departureNo & ")"  ' departureNo가 문자열이므로 작은따옴표로 감싸서 삽입
            conn.Execute sqlQuery
        End If
    Next row
    
    ' 연결 종료
    conn.Close
    Set conn = Nothing

    ' 엑셀 파일 닫기
    wb.Close False
    Set wb = Nothing

    MsgBox "Data has been successfully inserted into SQL database.", vbInformation

End Sub
