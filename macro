Sub InsertDepartureNoToSQL()

    Dim conn As Object
    Dim connStr As String
    Dim wb As Workbook
    Dim ws As Worksheet
    Dim row As Long
    Dim departureNo As String
    Dim material As String
    Dim supplier As String
    Dim filePath As String
    Dim insertQuery As String

    ' Downloads 폴더에 있는 arrival.xlsx 파일 경로 설정
    filePath = Environ("USERPROFILE") & "\Downloads\arrival.xlsx"

    ' DB 연결 문자열
    connStr = "Driver={SQL Server};" & _
              "Server=10.182.162.181;" & _
              "Database=tosca_com_repo;" & _
              "Uid=toscadbuser;" & _
              "Pwd=Pa55w0rd!!;" & _
              "TrustServerCertificate=yes;"

    ' SQL 연결 객체 생성
    Set conn = CreateObject("ADODB.Connection")
    conn.Open connStr

    ' arrival.xlsx 파일 열기
    Set wb = Workbooks.Open(filePath)
    Set ws = wb.Sheets(1)  ' 첫 번째 시트를 사용 (시트 이름에 따라 수정 가능)

    ' 데이터가 있는 행을 확인하여 반복
    For row = 2 To ws.Cells(ws.Rows.Count, "A").End(xlUp).Row ' A열을 기준으로 마지막 행 찾기
        ' DepartureNo 값 가져오기
        If Not IsEmpty(ws.Cells(row, "DepartureNo").Value) Then
            departureNo = CStr(ws.Cells(row, "DepartureNo").Value)
        Else
            departureNo = "" ' 빈 값이 있을 경우 처리
        End If

        ' Material 및 Supplier 값 가져오기
        If Not IsEmpty(ws.Cells(row, "Material").Value) Then
            material = CStr(ws.Cells(row, "Material").Value)
        Else
            material = "" ' 빈 값이 있을 경우 처리
        End If

        If Not IsEmpty(ws.Cells(row, "Supplier").Value) Then
            supplier = CStr(ws.Cells(row, "Supplier").Value)
        Else
            supplier = "" ' 빈 값이 있을 경우 처리
        End If

        ' DB에서 Material과 Supplier가 일치하는 경우에만 DepartureNo를 삽입
        insertQuery = "INSERT INTO YourTableName (DepartureNo) " & _
                      "SELECT '" & departureNo & "' " & _
                      "WHERE EXISTS (SELECT 1 FROM YourTableName " & _
                      "WHERE Material = '" & material & "' " & _
                      "AND Supplier = '" & supplier & "')"

        ' 디버깅용: 쿼리 출력
        Debug.Print "Insert Query: " & insertQuery

        ' SQL 쿼리 실행하여 조건에 맞는 DepartureNo 삽입
        conn.Execute insertQuery
    Next row
    
    ' 연결 종료
    conn.Close
    Set conn = Nothing

    ' 엑셀 파일 닫기
    wb.Close False
    Set wb = Nothing

    MsgBox "Data has been successfully inserted into SQL database.", vbInformation

End Sub
